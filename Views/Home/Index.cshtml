@model List<ForumsUnknown.Models.ForumPostViewModel>
@{
    ViewBag.Title = "Home Page";
    //Func<DateTime?, string> FormatDate = (date) => date?.ToString("MMMM dd yyyy hh:mm tt");
    Func<DateTime?, string> FormatDate = (date) => date?.ToString("o");
}

<main>
    @if (Session["Username"] == null)
    {
        <div id="MainContent1">
            <section class="row">
                <div class="col-lg-6 align-content-center">
                    <h1 class="text-light big-text fw-bold lh-1 pt-5">GAZE DEEP INTO THE <span class="text-secondary">ABYSS</span></h1>
                </div>
                <div class="col-lg-6 d-flex justify-content-end">
                    <img src="~/Images/alternate.jpg" class="img-fluid" alt="Alternate Image" width="400">
                </div>
            </section>
            <section class="row" aria-labelledby="aspnetTitle">
                <h1>ForumsUnknown</h1>
                <p class="lead">ForumsUnknown is a forum site offering a platform for users to share and discuss unusual, eerie, and mysterious topics.</p>
                <p><a runat="server" href="~/About" class="btn btn-dark">Learn more &raquo;</a></p>
            </section>

            <div class="row">
                <section class="col-md-4" aria-labelledby="gettingStartedTitle">
                    <h2 id="gettingStartedTitle">Connect with Like-Minded Explorers</h2>
                    <p>
                        Connect with a diverse community of curious minds from around the globe.
                        Discuss theories, share experiences, and engage in thought-provoking
                        conversations with others who share your passion for the unknown.
                    </p>
                    <p>
                        <a class="btn btn-outline-light" runat="server" href="~/About">Learn more &raquo;</a>
                    </p>
                </section>
                <section class="col-md-4" aria-labelledby="librariesTitle">
                    <h2 id="librariesTitle">Share Your Story</h2>
                    <p>
                        Have a chilling tale to tell or a baffling mystery to unravel?
                        Post it on ForumsUnknown and let our community of investigators
                        and enthusiasts weigh in.
                    </p>
                    <p>
                        <a class="btn btn-outline-light" runat="server" href="~/About">Learn more &raquo;</a>
                    </p>
                </section>
                <section class="col-md-4" aria-labelledby="hostingTitle">
                    <h2 id="hostingTitle">Join Us Today</h2>
                    <p>
                        Embark on a journey into the depths of the unknown. Join ForumsUnknown and become
                        part of a community dedicated to uncovering the mysteries of our world.
                    </p>
                    <p>
                        <a class="btn btn-outline-light" runat="server" href="~/About">Learn more &raquo;</a>
                    </p>
                </section>
            </div>
        </div>
    }
    else
    {
        if (!Model.Any())
        {
            <h2 class="display-6 mt-5">Be the first one to <a href="@Url.Action("CreatePost","Post")" class="text-danger text-decoration-none">share.</a></h2>
            <br /><br /><br />
        }
        else
        {
            foreach (var item in Model)
            {
                <div class="container bg-transparent post">
                    <div class="card p-5 pb-3 bg-transparent col-lg-6 border-light mx-auto custom-highlight" data-id="@item.PostID">
                        <div class="card-header border-light">
                            <div class="card-subtitle h5">
                                @if (item.ProfilePicPath != null)
                                {
                                    <img src="@item.ProfilePicPath" class="rounded-circle border border-3 border-light" height="30"/>
                                }<span class="text-danger">@item.AuthorName</span>
                            </div><br />
                            <div class="card-title display-6 fw-normal">@item.Title</div>
                        </div>
                        <div class="card-body">
                            @if (item.ModifiedAt != item.CreatedAt)
                            {
                                <p class="w-25"><span class="bg-secondary text-light px-2">Edited</span></p>
                            }
                            @if (item.Images != null && item.Images.Count > 0)
                            {
                                <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
                                    @if (item.Images.Count > 1)
                                    {
                                        <div class="carousel-indicators">
                                            @{
                                                int indicateCount = 0;
                                            }
                                            @foreach (var images in item.Images)
                                            {
                                                if (indicateCount == 0)
                                                {
                                                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="@indicateCount" class="active" aria-current="true" aria-label="Slide @indicateCount"></button>
                                                }
                                                else
                                                {
                                                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="@indicateCount" aria-label="Slide @indicateCount"></button>
                                                }

                                                indicateCount++;
                                            }
                                        </div>
                                    }

                                    <div class="carousel-inner">
                                        @{
                                            int count = 0;
                                        }
                                        @foreach (var image in item.Images)
                                        {
                                            if (count == 0)
                                            {
                                                <div class="carousel-item active">
                                                        <img src="@image.ImagePath" class="d-block w-100 img-fluid" alt="@image.AltText">
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="carousel-item">
                                                    <img src="@image.ImagePath" class="d-block w-100 img-fluid" alt="@image.AltText">
                                                </div>
                                            }
                                            count++;
                                        }
                                    </div>
                                </div>
                            }
                        <br />
                            @item.Content
                        </div>
                        <div class="card-footer">
                            <p class="created-at text-secondary" data-created-at="@FormatDate(item.CreatedAt)">@item.CreatedAt</p>
                        </div><br />
                        <div class="px-0"><button class="btn btn-sm btn-outline-light w-100">Comment</button></div>
                    </div>

                </div>
                <br /><br /><br />
            }
        }
    }

</main>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var cards = document.querySelectorAll(".card");

        cards.forEach(function (card) {
            card.addEventListener("click", function () {
                var postId = this.getAttribute("data-id");
                window.location.href = '/Post/' + postId;
            });
        });

        var carouselControls = document.querySelectorAll('#carouselExampleControls .carousel-control-prev, #carouselExampleControls .carousel-control-next');

        carouselControls.forEach(function (control) {
            control.addEventListener("click", function (event) {
                event.stopPropagation();
            });
        });
    });
</script>